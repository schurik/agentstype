---
phase: 02-core-feed-display
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - app/globals.css
  - app/components/feed/hooks/useConnectionStatus.ts
  - app/components/feed/hooks/useRelativeTime.ts
  - app/components/feed/hooks/useAutoScroll.ts
autonomous: true

must_haves:
  truths:
    - "Dependencies date-fns, react-intersection-observer, tw-animate-css are installed"
    - "Dark mode is explicitly set (not media query dependent)"
    - "Animation utilities animate-in, fade-in, slide-in-from-bottom are available"
    - "Connection status hook returns live/reconnecting/offline/idle"
    - "Relative time hook returns formatted string that updates"
    - "Auto-scroll hook detects when user is at bottom"
  artifacts:
    - path: "app/components/feed/hooks/useConnectionStatus.ts"
      provides: "Connection status detection from Convex"
      exports: ["useConnectionStatus"]
    - path: "app/components/feed/hooks/useRelativeTime.ts"
      provides: "Relative timestamp with periodic refresh"
      exports: ["useRelativeTime"]
    - path: "app/components/feed/hooks/useAutoScroll.ts"
      provides: "Smart auto-scroll behavior"
      exports: ["useAutoScroll"]
  key_links:
    - from: "app/components/feed/hooks/useConnectionStatus.ts"
      to: "convex/react"
      via: "useConvexConnectionState import"
      pattern: "useConvexConnectionState"
    - from: "app/components/feed/hooks/useRelativeTime.ts"
      to: "date-fns"
      via: "formatDistanceToNow import"
      pattern: "formatDistanceToNow"
    - from: "app/components/feed/hooks/useAutoScroll.ts"
      to: "react-intersection-observer"
      via: "useInView import"
      pattern: "useInView"
---

<objective>
Install dependencies and create reusable hooks for the event feed.

Purpose: Establish the foundation (dependencies, dark mode, animation utilities) and create the three custom hooks (connection status, relative time, auto-scroll) that the feed components will use.

Output: Installed dependencies, configured globals.css with tw-animate-css and explicit dark mode, three hook files ready for use by Plan 02 components.
</objective>

<execution_context>
@/Users/alexander.buss/.claude/get-shit-done/workflows/execute-plan.md
@/Users/alexander.buss/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-feed-display/02-CONTEXT.md
@.planning/phases/02-core-feed-display/02-RESEARCH.md
@app/globals.css
@app/layout.tsx
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and configure dark mode</name>
  <files>package.json, app/globals.css, app/layout.tsx</files>
  <action>
1. Install dependencies:
   ```bash
   bun add date-fns react-intersection-observer tw-animate-css
   ```

2. Update globals.css:
   - Add `@import "tw-animate-css";` after the tailwindcss import
   - Force dark mode by removing media query and setting dark values directly:
     - --background: #0a0a0a
     - --foreground: #ededed
   - Keep the @theme inline block as-is

3. Update layout.tsx:
   - Add `className="dark"` to the html element to enable Tailwind dark: variants
   - Update metadata title to "agentstype.dev" and description to "Watch Claude Code sessions in real-time"

Expected globals.css structure:
```css
@import "tailwindcss";
@import "tw-animate-css";

:root {
  --background: #0a0a0a;
  --foreground: #ededed;
}

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
}

body {
  background: var(--background);
  color: var(--foreground);
  font-family: var(--font-mono);
}
```
  </action>
  <verify>
- `bun run build` succeeds
- Check package.json has date-fns, react-intersection-observer, tw-animate-css
- Check globals.css has tw-animate-css import
- Check layout.tsx has dark class on html element
  </verify>
  <done>Dependencies installed, dark mode forced (not media query), animation classes available, monospace font default</done>
</task>

<task type="auto">
  <name>Task 2: Create connection status, relative time, and auto-scroll hooks</name>
  <files>
    app/components/feed/hooks/useConnectionStatus.ts
    app/components/feed/hooks/useRelativeTime.ts
    app/components/feed/hooks/useAutoScroll.ts
  </files>
  <action>
Create three hook files following the patterns from RESEARCH.md:

**useConnectionStatus.ts:**
- "use client" directive at top
- Import useConvexConnectionState from "convex/react"
- Return type: "live" | "reconnecting" | "offline" | "idle"
- Logic:
  - If !hasEverConnected: "offline"
  - If !isWebSocketConnected && connectionRetries > 0: "reconnecting"
  - If !isWebSocketConnected: "offline"
  - Otherwise: "live" (idle detection deferred to later phase)

**useRelativeTime.ts:**
- "use client" directive at top
- Import formatDistanceToNow from "date-fns"
- Accept timestamp: number and optional refreshInterval (default 60000ms)
- Use useState to track relative string
- Use useEffect with setInterval to refresh
- Return cleanup function from useEffect
- Return the relative string

**useAutoScroll.ts:**
- "use client" directive at top
- Import useInView from "react-intersection-observer"
- Import useRef, useEffect, useState from "react"
- Generic function useAutoScroll<T>(items: T[], initialLoadSize: number)
- Track isAtBottom using intersection observer on sentinel element
- Track newItemCount when user scrolls up and new items arrive
- Only increment newItemCount for items beyond initialLoadSize
- Provide scrollToBottom function
- Return: { bottomRef, sentinelRef, newItemCount, scrollToBottom, isAtBottom }
  </action>
  <verify>
- TypeScript compiles: `bunx tsc --noEmit`
- Files exist at correct paths
- Each file has "use client" directive
- Each file exports the named hook
  </verify>
  <done>Three hooks created with proper types, client directives, and cleanup functions</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `bun run build` passes
2. All three hook files exist and export correctly
3. globals.css has tw-animate-css import and dark mode defaults
4. layout.tsx has dark class on html
</verification>

<success_criteria>
- Dependencies installed (date-fns, react-intersection-observer, tw-animate-css in package.json)
- Dark mode forced (not dependent on prefers-color-scheme)
- Animation utilities available (animate-in, fade-in, slide-in-from-bottom work)
- useConnectionStatus returns appropriate status based on Convex connection
- useRelativeTime formats timestamps and refreshes periodically
- useAutoScroll tracks scroll position and new item count
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-feed-display/02-01-SUMMARY.md`
</output>
