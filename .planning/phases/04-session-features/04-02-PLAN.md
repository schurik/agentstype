---
phase: 04-session-features
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - app/globals.css
  - app/lib/formatters.ts
  - app/hooks/useSessionStats.ts
  - app/hooks/useSessionStatus.ts
  - app/components/feed/ThinkingIndicator.tsx
  - app/components/feed/SessionHeader.tsx
autonomous: true

must_haves:
  truths:
    - "Session stats (duration, event count, files, commits) can be computed from events"
    - "Session status (live vs completed) is derived from events and recency"
    - "Thinking indicator shows shimmer animation when session is live"
    - "Session header displays goal, status, time range, and expandable stats"
  artifacts:
    - path: "app/hooks/useSessionStats.ts"
      provides: "Session stats computation hook"
      exports: ["useSessionStats"]
    - path: "app/hooks/useSessionStatus.ts"
      provides: "Session live/completed status hook"
      exports: ["useSessionStatus"]
    - path: "app/components/feed/ThinkingIndicator.tsx"
      provides: "Animated shimmer indicator"
      exports: ["ThinkingIndicator"]
    - path: "app/components/feed/SessionHeader.tsx"
      provides: "Rich session header card"
      exports: ["SessionHeader"]
  key_links:
    - from: "app/components/feed/SessionHeader.tsx"
      to: "app/hooks/useSessionStats.ts"
      via: "hook import"
      pattern: "useSessionStats"
    - from: "app/components/feed/SessionHeader.tsx"
      to: "app/components/feed/ThinkingIndicator.tsx"
      via: "component import"
      pattern: "ThinkingIndicator"
---

<objective>
Create session header component with stats computation, status derivation, and thinking indicator

Purpose: Display rich session information at top of feed when a session is selected
Output: SessionHeader component with goal, status badge, time range, collapsible stats, and thinking shimmer
</objective>

<execution_context>
@/Users/alexander.buss/.claude/get-shit-done/workflows/execute-plan.md
@/Users/alexander.buss/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-session-features/04-RESEARCH.md
@.planning/phases/04-session-features/04-CONTEXT.md
@.planning/phases/04-session-features/04-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add shimmer animation and create formatters</name>
  <files>app/globals.css, app/lib/formatters.ts</files>
  <action>
    1. Add shimmer keyframes to app/globals.css:
       ```css
       @keyframes shimmer {
         0% { transform: translateX(-100%); }
         100% { transform: translateX(100%); }
       }

       .animate-shimmer {
         animation: shimmer 2s linear infinite;
       }
       ```

    2. Create app/lib/formatters.ts with date-fns utilities:
       - formatTime(timestamp: number | null | undefined): string
         - Returns "h:mma" format (e.g., "2:30pm") using date-fns format()
         - Returns empty string for null/undefined
       - formatDuration(ms: number): string
         - Returns "X min" for < 60 minutes
         - Returns "Xh Ym" for >= 60 minutes
       - formatRelativeTime(timestamp: number): string
         - Uses date-fns formatDistanceToNow with addSuffix: true

    Pattern from 04-RESEARCH.md code examples.
  </action>
  <verify>
    TypeScript compiles without errors
    Import from '@/app/lib/formatters' works
  </verify>
  <done>
    Shimmer animation available as .animate-shimmer class
    Date formatting utilities ready for session header
  </done>
</task>

<task type="auto">
  <name>Task 2: Create session stats and status hooks</name>
  <files>app/hooks/useSessionStats.ts, app/hooks/useSessionStatus.ts</files>
  <action>
    1. Create app/hooks/useSessionStats.ts:
       - Import useMemo from react
       - Accept events array and sessionId as params
       - Filter events to matching sessionId
       - Compute:
         - duration (lastTimestamp - firstTimestamp in ms)
         - eventCount (excluding session_start/session_end)
         - filesCount (unique file paths from Edit/Write/Read tools)
         - commitsCount (Bash commands containing 'git commit')
         - isComplete (has session_end event)
         - startTime, endTime
       - Memoize with [events, sessionId] dependencies
       - Return null if no events or no sessionId

    2. Create app/hooks/useSessionStatus.ts:
       - Import useMemo from react
       - Accept events array and sessionId
       - Define ACTIVITY_THRESHOLD_MS = 5 * 60 * 1000 (5 minutes)
       - Derive:
         - isLive: no session_end AND latest event within threshold
         - lastActivity: most recent timestamp
       - Return { isLive: boolean, lastActivity: number | null }

    Pattern from 04-RESEARCH.md useSessionStats and useSessionStatus examples.
  </action>
  <verify>
    TypeScript compiles without errors
    Hooks can be imported: `import { useSessionStats } from '@/app/hooks/useSessionStats'`
  </verify>
  <done>
    Both hooks compute/derive session data from events array
  </done>
</task>

<task type="auto">
  <name>Task 3: Create ThinkingIndicator and SessionHeader components</name>
  <files>app/components/feed/ThinkingIndicator.tsx, app/components/feed/SessionHeader.tsx</files>
  <action>
    1. Create app/components/feed/ThinkingIndicator.tsx:
       - 'use client' directive
       - Props: { actionType?: string }
       - Display shimmer bar with label
       - Use bg-zinc-800/50 container, zinc-700 base, gradient shimmer
       - Label defaults to "Thinking..." or shows actionType context
       - Apply animate-shimmer class from globals.css

    2. Create app/components/feed/SessionHeader.tsx:
       - 'use client' directive
       - Props interface:
         - goal: string | null
         - stats: ReturnType<typeof useSessionStats> (SessionStats | null)
         - status: ReturnType<typeof useSessionStatus>
         - latestEventTool?: string (for thinking context)
       - Structure:
         a. Status badge row: green pulse dot + "Live" OR gray dot + "Completed"
         b. Goal text (if present, line-clamp-2)
         c. Time range: "Started 2:30pm" or "2:30pm - 3:15pm (45 min)"
         d. Collapsible stats button/section using useState
         e. Stats grid (when expanded): Events, Files, Commits, Duration
         f. ThinkingIndicator (when isLive and can show action context)
       - Use formatTime, formatDuration from '@/app/lib/formatters'
       - Styling: border-b border-zinc-800, bg-zinc-900, p-4

    Pattern from 04-RESEARCH.md SessionHeader and ThinkingIndicator examples.
  </action>
  <verify>
    TypeScript compiles without errors
    Components render without errors (can verify visually in later plan)
  </verify>
  <done>
    SessionHeader displays goal, status, time range, stats, and thinking indicator
    ThinkingIndicator shows animated shimmer with action context
  </done>
</task>

</tasks>

<verification>
1. `bun run build` passes
2. All new files can be imported without errors
3. Shimmer animation defined in globals.css
</verification>

<success_criteria>
- Shimmer animation works (.animate-shimmer class)
- formatTime, formatDuration, formatRelativeTime utilities work
- useSessionStats computes duration, eventCount, filesCount, commitsCount from events
- useSessionStatus derives isLive from session_end presence and recency
- SessionHeader displays all required information with collapsible stats
- ThinkingIndicator shows shimmer with action context
</success_criteria>

<output>
After completion, create `.planning/phases/04-session-features/04-02-SUMMARY.md`
</output>
