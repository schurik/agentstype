---
phase: 04-session-features
plan: 04
type: execute
wave: 3
depends_on: ["04-02", "04-03"]
files_modified:
  - app/components/feed/EventFeed.tsx
  - app/components/feed/EventCard.tsx
  - app/live/LiveFeedContent.tsx
autonomous: false

must_haves:
  truths:
    - "Session header appears at top of feed when session is selected"
    - "Feed is filtered by session and agent when selected"
    - "Git commit events are visually highlighted as milestones"
    - "Thinking indicator shows in session header when session is live"
    - "All Phase 4 features work together in /live page"
  artifacts:
    - path: "app/components/feed/EventFeed.tsx"
      provides: "EventFeed with session header and agent filtering"
      min_lines: 100
    - path: "app/components/feed/EventCard.tsx"
      provides: "EventCard with commit milestone styling"
  key_links:
    - from: "app/components/feed/EventFeed.tsx"
      to: "app/components/feed/SessionHeader.tsx"
      via: "component import"
      pattern: "SessionHeader"
    - from: "app/components/feed/EventFeed.tsx"
      to: "app/hooks/useSessionFilter.ts"
      via: "hook import"
      pattern: "useSessionFilter"
---

<objective>
Integrate session header, filtering, and commit markers into the live feed

Purpose: Complete Phase 4 by wiring all session features together and adding visual polish
Output: Working /live page with session header, hierarchical filtering, and commit markers
</objective>

<execution_context>
@/Users/alexander.buss/.claude/get-shit-done/workflows/execute-plan.md
@/Users/alexander.buss/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-session-features/04-RESEARCH.md
@.planning/phases/04-session-features/04-CONTEXT.md
@.planning/phases/04-session-features/04-01-SUMMARY.md
@.planning/phases/04-session-features/04-02-SUMMARY.md
@.planning/phases/04-session-features/04-03-SUMMARY.md
@app/components/feed/EventFeed.tsx
@app/components/feed/EventCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add commit marker styling to EventCard</name>
  <files>app/components/feed/EventCard.tsx</files>
  <action>
    1. Detect commit events:
       - Check if tool === 'Bash' AND toolInput?.command includes 'git commit'
       - Or check type === 'post_tool_use' AND similar command pattern

    2. Add visual milestone styling for commits:
       - Add a small git commit icon (or checkmark in circle)
       - Add subtle left border accent (e.g., border-l-2 border-green-600)
       - Add "Commit" label/badge next to tool name
       - Keep existing card styling, just add accent

    3. Optional: Extract commit message from command if available
       - Parse -m "message" from command string
       - Show abbreviated message in card summary

    This satisfies SESS-04: Commit markers highlight git commits as milestones.
  </action>
  <verify>
    TypeScript compiles without errors
    Commit events visually distinct from other Bash events
  </verify>
  <done>
    Git commit events show milestone styling with border accent and commit icon/badge
  </done>
</task>

<task type="auto">
  <name>Task 2: Update EventFeed with session header and agent filtering</name>
  <files>app/components/feed/EventFeed.tsx</files>
  <action>
    1. Import new dependencies:
       - SessionHeader from './SessionHeader'
       - useSessionFilter from '@/app/hooks/useSessionFilter'
       - useAgentFilter from '@/app/hooks/useAgentFilter'
       - useSessionStats from '@/app/hooks/useSessionStats'
       - useSessionStatus from '@/app/hooks/useSessionStatus'

    2. Get session and agent state:
       - const [session] = useSessionFilter()
       - const [agent] = useAgentFilter()

    3. Update listEvents query call:
       - Pass sessionId: session ?? undefined
       - Pass agentId: agent ?? undefined
       - (projectName already passed from existing code)

    4. Compute session data for header:
       - const stats = useSessionStats(events, session)
       - const status = useSessionStatus(events, session)
       - const goal = find first user_prompt_submit event's prompt field

    5. Conditionally render SessionHeader:
       - If session is selected, render SessionHeader above event list
       - Pass goal, stats, status, and latestEventTool (for thinking context)

    6. Extract latestEventTool:
       - From most recent non-session event's tool field
       - Used for "Reading files..." / "Writing code..." context

    7. Handle empty state when session selected but no events:
       - Show "No events in this session" message
  </action>
  <verify>
    TypeScript compiles without errors
    EventFeed renders session header when session selected
  </verify>
  <done>
    EventFeed shows SessionHeader when session selected
    Feed filtered by session and optionally by agent
    Thinking indicator shows action context from latest event
  </done>
</task>

<task type="auto">
  <name>Task 3: Update LiveFeedContent for complete integration</name>
  <files>app/live/LiveFeedContent.tsx</files>
  <action>
    1. Verify all URL state is properly handled:
       - project from useProjectFilter
       - session from useSessionFilter
       - agent from useAgentFilter

    2. Ensure props are passed correctly to EventFeed:
       - EventFeed should receive what it needs from parent or use hooks internally

    3. Add empty state for "Select a session":
       - If no session selected but project is selected:
         - Option A: Show all project events (current behavior)
         - Option B: Show "Select a session from the sidebar"
       - Per CONTEXT.md: "Empty state prompt when no session selected"
       - Implement Option B: Show guidance text above event list

    4. Test that sidebar and feed work together:
       - Selecting project shows all project events
       - Selecting session filters to session events and shows header
       - Selecting agent further filters to agent events
  </action>
  <verify>
    TypeScript compiles without errors
    Page navigation works correctly
  </verify>
  <done>
    LiveFeedContent properly integrates all session features
    Empty state guidance shown when appropriate
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete Phase 4 session features:
    1. Sidebar hierarchy: Project > Session > Agent
    2. Session header with goal, status, time range, collapsible stats
    3. Thinking indicator with shimmer animation
    4. Commit milestone markers on git commit events
    5. Session/agent filtering via URL state
  </what-built>
  <how-to-verify>
    1. Start dev servers: `bun dev` and `bunx convex dev`
    2. Open http://localhost:3000/live
    3. Verify sidebar:
       - Click project to expand sessions list
       - Live sessions show green pulse, completed show gray dot
       - Click session to see agents under it
       - Click agent to filter feed
    4. Verify session header:
       - When session selected, header appears above feed
       - Shows goal (if available), status badge, time range
       - Click "Show stats" to expand stats grid
       - If session is live, shimmer indicator appears
    5. Verify commit markers:
       - Any git commit events have visual accent (border, icon)
    6. Verify URL state:
       - URL updates as you navigate: ?project=x&session=y&agent=z
       - Refresh page - selection persists
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. `bun run build` passes
2. All session features work in browser
3. URL state correctly reflects selection
4. Session header displays when session selected
5. Commit events have milestone styling
</verification>

<success_criteria>
- Session header appears with goal, status, time, and stats when session selected
- Thinking indicator shows shimmer when session is live
- Sidebar hierarchy is fully navigable
- Git commit events are visually distinct milestones
- URL state syncs: ?project=&session=&agent=
- All Phase 4 requirements satisfied (except SESS-03 which is deferred)
</success_criteria>

<output>
After completion, create `.planning/phases/04-session-features/04-04-SUMMARY.md`
</output>
